#!/bin/bash

eval `xargs` # ; sbfont green ; env | grep SB ; echo $PATH ; sbfont white

echo $SBFLAGS | grep "APPEND" >/dev/null
if [[ $? -eq 0 ]]
	then
	REDIR="APPEND"
	fi

TEMPFILE="$SBPATH/$SBDIR/$1.temp"

TARGET="$SBPATH/$SBDIR/$SBPAGE-$SBSECTION.php"

if [[ $REDIR == "APPEND" ]]
	then
	grep -v  '</pre>' $TARGET > $$
#	mv $TEMPFILE $TARGET
	else
	echo "  <pre>" > $TARGET
	fi

sed 's/\[/~~[[/g' $TEMPFILE | sed -f $SBPATH/sbshell/sbshell-rcmds/tty-to-html.sed | while read LINE

	do 
	echo $LINE | grep "prompt" >/dev/null
        if [[ $? -eq 0 ]]
                then
		while [[ `echo $LINE | grep '.~H~~~\[\[K' > /dev/null ; echo $?` -eq 0 ]]
		   do
		   LINE=`echo $LINE | sed 's/.~H~~~\[\[K//'`
		   done
                echo "$LINE </span>" | sed 's/~G~//g'
                else
                echo "$LINE"
                fi >> $TARGET
        done

echo "  </pre>" >> $TARGET

